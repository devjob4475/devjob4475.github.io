<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>เล่น M3U8 ทันที</title>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #000;
      padding: 20px;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: auto;
      font-family: 'Prompt', sans-serif;
    }
    video {
      width: 90%;
      max-width: 1000px;
      border: 4px solid #fff;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .channels {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .channel-button {
      background-color: #222;
      color: white;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #fff;
      cursor: pointer;
      text-align: center;
      width: 120px;
      font-family: 'Prompt', sans-serif;
      outline: none;
    }
    .channel-button img {
      width: 40px;
      height: 40px;
      border-radius: 5px;
      margin-bottom: 5px;
    }
    .channel-button:hover,
    .channel-button:focus {
      background-color: #444;
    }

    .channel-number {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 36px;
      color: #fff;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 10px;
      display: none;
    }
  </style>
</head>
<body>

    <video id="video" controls autoplay muted></video>

  <div class="channels" id="channels"></div>

  <div id="channelNumber" class="channel-number">12</div>


  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  
  <script>
    const video = document.getElementById('video');
    const channelNumberDiv = document.getElementById('channelNumber');
    function toggleBorder() {
    if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement) {
      video.style.border = 'none';  // ลบ border เมื่อเต็มจอ
    } else {
      video.style.border = '4px solid #fff';  // เพิ่ม border เมื่อออกจากโหมดเต็มจอ
    }
  }

  // การตรวจจับเมื่อเข้าสู่/ออกจากโหมดเต็มจอ
  document.addEventListener('fullscreenchange', toggleBorder);
  document.addEventListener('webkitfullscreenchange', toggleBorder);
  document.addEventListener('mozfullscreenchange', toggleBorder);

  // ในกรณีที่เป็นเบราว์เซอร์ที่ไม่รองรับ fullscreenchange
  video.addEventListener('dblclick', function() {
    if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement) {
      if (video.requestFullscreen) {
        video.requestFullscreen();
      } else if (video.webkitRequestFullscreen) {
        video.webkitRequestFullscreen();
      } else if (video.mozRequestFullScreen) {
        video.mozRequestFullScreen();
      }
    }
  });
    const channelsDiv = document.getElementById('channels');
    let selectedIndex = 0;

    const channelNames = [
      'ช่อง EPL 1', 'ช่อง EPL 1 Backup', 'ช่อง EPL 2', 'ช่อง EPL 2 Backup',
      'ช่อง EPL 3', 'ช่อง EPL 3 Backup', 'ช่อง EPL 4', 'ช่อง EPL 4 Backup',
      'ช่อง EPL 5', 'ช่อง EPL 5 Backup','ช่อง Bein 1', 'ช่อง Bein 1 Backup',
      'ช่อง Bein 2', 'ช่อง Bein 2 Backup','ช่อง Bein 3', 'ช่อง Bein 3 Backup',
      'ช่อง Bein HD 1',
      'ช่อง Bein HD 2',
      'ช่อง Bein HD 3',
      'ช่อง Bein HD 4',
      'ช่อง Bein HD 5',
      'ช่อง Bein HD 6',
      'ช่อง Bein HD 7',
      'ช่อง Bein HD 8',
      'ช่อง Bein HD 9',
      'ช่อง Bein HD 10',
      'ช่อง Bein HD 11',
      'ช่อง Bein HD 12',
    ];

    const channelLogos = [
      'https://rentapi.blackboxsys.net/images/png/epl-1.png', 'https://rentapi.blackboxsys.net/images/png/epl-1bkp.png',
      'https://rentapi.blackboxsys.net/images/png/epl-2.png', 'https://rentapi.blackboxsys.net/images/png/epl-2bkp.png',
      'https://rentapi.blackboxsys.net/images/png/epl-3.png', 'https://rentapi.blackboxsys.net/images/png/epl-3bkp.png',
      'https://rentapi.blackboxsys.net/images/png/epl-4.png', 'https://rentapi.blackboxsys.net/images/png/epl-4bkp.png',
      'https://rentapi.blackboxsys.net/images/png/epl-5.png', 'https://rentapi.blackboxsys.net/images/png/epl-5bkp.png',
      'https://static.uflixtv.com/images/tv/png/epl-bein1.png', 'https://static.uflixtv.com/images/tv/png/epl-bein1bkp.png',
      'https://static.uflixtv.com/images/tv/png/epl-bein2.png', 'https://static.uflixtv.com/images/tv/png/epl-bein2bkp.png',
      'https://static.uflixtv.com/images/tv/png/epl-bein3.png', 'https://static.uflixtv.com/images/tv/png/epl-bein3bkp.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein1.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein2.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein3.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein4.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein5.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein6.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein7.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein8.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein9.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein10.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein11.png',
      'https://static.uflixtv.com/images/tv/channels_icons/hd-bein12.png',
    ];

    // กำหนด playBaseUrls เอง
    const playBaseUrls = [
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl1&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl1bkp&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl2&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl2bkp&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl3&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl3bkp&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl4&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl4bkp&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl5&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl5bkp&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-bein1&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=epl-bein1&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-bein2&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=epl-bein2&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-bein3&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=epl-bein3&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein1&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein2&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein3&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein4&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein5&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein6&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein7&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein8&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein9&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein10&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein11&kauth=',
      'https://cloud.ufxtv.com/api/tv/channels/play/?c=hd-bein12&kauth=',
    ];

    // ฟังก์ชันดึง playlist URL
    async function getPlaylist(user_loggedsession, playBaseUrl) {
      const playUrl = `${playBaseUrl}&user_loggedsession=${user_loggedsession}`;
      const response = await fetch(playUrl);
      const text = await response.text();
      return text.includes('<clear_url>') ? text : null;
    }

    // ดึง session ใหม่
    async function login() {
      const response = await fetch('https://cloud.ufxtv.com/api/user/login/?user_email=BE0341&user_password=1111&kauth=');
      const text = await response.text();
      const sessionMatch = text.match(/<user_loggedsession>(.*?)<\/user_loggedsession>/);
      return sessionMatch ? sessionMatch[1] : null;
    }

    // ดึง clear_url จาก response XML
    function extractClearUrl(xml) {
      const match = xml.match(/<clear_url>(.*?)<\/clear_url>/);
      return match ? match[1] : null;
    }

    // แสดงผลลัพธ์แบบ playlist
    function renderPlaylist(index) {
  const button = document.createElement('div');
  button.classList.add('channel-button');
  button.tabIndex = 0;
  button.innerHTML = ` 
    <img src="${channelLogos[index]}" alt="${channelNames[index]}">
    <div>${index + 1}. ${channelNames[index]}</div>
  `;

  // โหลด playlist เมื่อผู้ใช้คลิก
  button.onclick = () => loadChannelByIndex(index);
  button.onkeydown = (e) => {
    if (e.key === 'Enter') {
      loadChannelByIndex(index);
    }
  };

  channelsDiv.appendChild(button);
}
    // ฟังก์ชันในการโหลดช่องที่เลือก
    function loadChannel(url) {
  const isMobile = /Mobi|Android/i.test(navigator.userAgent);

  if (isMobile) {
    video.src = url;
    video.load();
    video.play();
  } else if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
  } else {
    alert('เบราว์เซอร์ของคุณไม่รองรับ HLS 😥');
  }
}


    // Main
    async function loadChannelByIndex(index) {
  if (!session) {
    session = await login();
    if (!session) {
      alert("ไม่สามารถเข้าสู่ระบบได้ ❌");
      return;
    }
  }

  const xml = await getPlaylist(session, playBaseUrls[index]);
  const clearUrl = extractClearUrl(xml);
  if (clearUrl) {
    const fixedUrl = clearUrl.replace('playlist.m3u8', 'chunks.m3u8');
    loadChannel(fixedUrl);
  } else {
    alert('ไม่พบลิงก์ playlist ❌');
  }
}

// ฟังก์ชันหลัก
let session = null;
(async () => {
  session = await login();
  if (!session) {
    alert("ไม่สามารถเข้าสู่ระบบได้ ❌");
    return;
  }

  // แสดงปุ่มทุกช่องล่วงหน้า (ยังไม่โหลด video)
  for (let i = 0; i < playBaseUrls.length; i++) {
    renderPlaylist(i);
  }

  // เล่นช่องแรกทันที
  loadChannelByIndex(0);
})();

    // การควบคุมโดยใช้ปุ่มลูกศร
    let currentKey = ''
    document.addEventListener('keydown', (e) => {
      const buttons = document.querySelectorAll('.channel-button');
      if (e.key === 'ArrowDown') {
        selectedIndex = (selectedIndex + 3) % buttons.length; // เลื่อนลง 3 ช่อง
        buttons[selectedIndex].focus();
      } else if (e.key === 'ArrowUp') {
        selectedIndex = (selectedIndex - 3 + buttons.length) % buttons.length; // เลื่อนขึ้น 3 ช่อง
        buttons[selectedIndex].focus();
      } else if (e.key === 'ArrowLeft') {
        selectedIndex = (selectedIndex - 1 + buttons.length) % buttons.length; // เลื่อนซ้าย 1 ช่อง
        buttons[selectedIndex].focus();
      } else if (e.key === 'ArrowRight') {
        selectedIndex = (selectedIndex + 1) % buttons.length; // เลื่อนขวา 1 ช่อง
        buttons[selectedIndex].focus();
      }


      
  if (!isNaN(e.key)) {
      currentKey += e.key;  
      showChannelNumber(parseInt(currentKey)); 
  } else {
    currentKey = ''
  }

    // แสดงหมายเลขช่องที่เลือก
    function showChannelNumber(channelNumber) {
    channelNumberDiv.textContent = channelNumber;
    channelNumberDiv.style.display = 'flex';
    setTimeout(() => {
      channelNumberDiv.style.display = 'none';
      currentKey = '';
      // เริ่มเล่นช่องหลังจากการแสดงหมายเลข
      const button = buttons[channelNumber - 1];
      button.click(); // คลิกที่ช่อง
      button.focus(); // ให้โฟกัสที่ปุ่มช่อง
      loadChannel(buttons[channelNumber - 1].getAttribute('data-url')); // ใช้ data-url เพื่อระบุลิงก์ช่อง
    }, 3000);
  }
    });

    // เพิ่มการเข้าสู่โหมด fullscreen เมื่อ video เริ่มเล่น
    video.addEventListener('play', () => {
  // ตรวจสอบว่าเป็นอุปกรณ์มือถือหรือไม่
  if (/Mobi|Android/i.test(navigator.userAgent)) {
    if (video.requestFullscreen) {
      video.requestFullscreen();
    } else if (video.mozRequestFullScreen) { // Firefox
      video.mozRequestFullScreen();
    } else if (video.webkitRequestFullscreen) { // Chrome, Safari and Opera
      video.webkitRequestFullscreen();
    } else if (video.msRequestFullscreen) { // IE/Edge
      video.msRequestFullscreen();
    }
  }
});
  </script>
</body>
</html>
