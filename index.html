<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Playlist</title>
  
</head>
<body bgcolor="FFFFFF">
  <!-- <h2>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2> -->
  <pre id="playlistOutput"></pre>

  <script>
    const loginUrl = 'https://cloud.ufxtv.com/api/user/login/?user_email=BE0268&user_password=1111&kauth=';
    const playBaseUrl = 'https://cloud.ufxtv.com/api/tv/channels/play/?c=uflix-epl1&kauth=';

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á playlist URL
    async function getPlaylist(user_loggedsession) {
      const playUrl = `${playBaseUrl}&user_loggedsession=${user_loggedsession}`;
      const response = await fetch(playUrl);
      const text = await response.text();
      return text.includes('<clear_url>') ? text : null;
    }

    // ‡∏î‡∏∂‡∏á session ‡πÉ‡∏´‡∏°‡πà
    async function login() {
      const response = await fetch(loginUrl);
      const text = await response.text();
      const sessionMatch = text.match(/<user_loggedsession>(.*?)<\/user_loggedsession>/);
      return sessionMatch ? sessionMatch[1] : null;
    }

    // ‡∏î‡∏∂‡∏á clear_url ‡∏à‡∏≤‡∏Å response XML
    function extractClearUrl(xml) {
      const match = xml.match(/<clear_url>(.*?)<\/clear_url>/);
      return match ? match[1] : null;
    }

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏ö‡∏ö playlist
    function renderPlaylist(clearUrl) {
  const fixedUrl = clearUrl.replace('playlist.m3u8', 'chunks.m3u8');
  const output = `
#EXTM3U

########################################
### Uflix ###
########################################

#EXTINF:-1 group-title="‡∏Å‡∏µ‡∏¨‡∏≤" tvg-logo="https://static.uflixtv.com/images/tv/channels_icons/epl-1.png",EPL-1
${fixedUrl}
`;
  document.getElementById('playlistOutput').textContent = output.trim();

  // üëâ redirect ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    window.location.href = 'https://www.google.com';

}


    // Main
    (async () => {
      let session = 'dhEVBSnVeab9ebnJzrC3WeiYsBuJWaaTuuBNJow3ux8izAVVO767f23918d76a4';
      let xml = await getPlaylist(session);

      if (!xml) {
        // ‡∏ñ‡πâ‡∏≤ session ‡πÄ‡∏Å‡πà‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
        session = await login();
        if (!session) {
          document.querySelector('h2').textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ ‚ùå";
          return;
        }
        xml = await getPlaylist(session);
      }

      const clearUrl = extractClearUrl(xml);
      if (clearUrl) {
        renderPlaylist(clearUrl);
      } else {
        document.querySelector('h2').textContent = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå playlist ‚ùå";
      }
    })();
  </script>
</body>
</html>
